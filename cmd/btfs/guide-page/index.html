<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Guide</title>
</head>
<body>
<h1>Guide</h1>
<p>BTFS: <span id="version"></span></p>
<p>HOSTID: <span id="host-id"></span></p>
<p>BTTC Address: <span id="bttc-address"></span></p>
<p>Private Key: <span id="private-key"></span></p>
<script>
    window.onload = function (){
        let checkInterval = setInterval(function (){
            console.log("check ready...")
            let xhr = new XMLHttpRequest()
            xhr.timeout = 200
            xhr.onreadystatechange = function () {
                if ( xhr.status === 200 ) {
                    console.log("ready")
                    clearInterval(checkInterval)
                    window.location.href = "/dashboard"
                }
            }
            xhr.open('POST', '/api/v1/id')
            xhr.send()
        }, 1000);

        (function () {
            let xhr = new XMLHttpRequest()
            xhr.timeout = 1000
            xhr.responseType = 'json'
            xhr.onload = function (){
                let resp = xhr.response
                console.log(resp)
                if (resp.ret === 0) {
                    let elVersion = document.getElementById("version")
                    let elHostID = document.getElementById("host-id")
                    let elBttcAddress = document.getElementById("bttc-address")
                    let elPrivateKey = document.getElementById("private-key")
                    elVersion.innerText = resp.info.btfs_version
                    elHostID.innerText = resp.info.host_id
                    elBttcAddress.innerText = resp.info.bttc_address
                    elPrivateKey.innerText = resp.info.private_key
                }
            }
            xhr.open('GET', '/api/guide-info')
            xhr.send()
        })();
    }
</script>
</body>
</html>